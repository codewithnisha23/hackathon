<!DOCTYPE html>
<html>
<head>
<title>Buyer Dashboard – ReLoop</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{font-family:Inter, sans-serif;background:#0f1222;color:white;}
.navbar{padding:18px;background:#171a36;font-weight:700;}
.card{background:#1b1f3b;padding:18px;margin:18px;border-radius:12px;}
button{padding:10px 16px;border:none;border-radius:999px;background:#7c4dff;color:white;}
input{padding:10px;width:100%;border-radius:10px;border:none;}
table{width:100%;border-collapse:collapse;}
th{background:#7c4dff;color:white;}
th,td{padding:10px;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#0008;align-items:center;justify-content:center;}
.modal-content{background:#1b1f3b;padding:20px;border-radius:12px;}
.toast{position:fixed;bottom:20px;right:20px;background:#7c4dff;padding:10px;border-radius:10px;display:none;}
</style>
</head>

<body>

<div class="navbar">
  Buyer Dashboard – ReLoop
  <button style="float:right" onclick="openProfile()">Profile</button>
</div>

<div class="card">
<h3>Notifications</h3>
<ul id="notificationList"></ul>
</div>

<div class="card">
<h3>Search Material</h3>
<input id="buyerSearch" placeholder="Search..." onkeyup="searchTable()">
</div>

<div class="card">
<table id="materialTable">
<tr>
<th>Material</th>
<th>Qty</th>
<th>Location</th>
<th>Price</th>
<th>Action</th>
</tr>
</table>
</div>

<div id="profileModal" class="modal">
<div class="modal-content">
<h3>My Profile</h3>
<p id="pName"></p>
<p id="pEmail"></p>
<h4>Orders</h4>
<ul id="orders"></ul>
<button onclick="closeProfile()">Close</button>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
// ---------- TOAST ----------
function showToast(msg){
  let t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>t.style.display="none",2000);
}

// ---------- DEMO NOTIFICATIONS ----------
function ensureBuyerNotes(){
  let notes=JSON.parse(localStorage.getItem("buyerNotes"));
  if(!notes || notes.length===0){
    notes=["New Plastic listed in Mumbai"];
    localStorage.setItem("buyerNotes",JSON.stringify(notes));
  }
}

function loadBuyerNotifications(){
  ensureBuyerNotes();
  let list=document.getElementById("notificationList");
  list.innerHTML="";
  let data=JSON.parse(localStorage.getItem("buyerNotes"))||[];
  data.slice(-5).reverse().forEach(n=>{
    let li=document.createElement("li");
    li.innerText=n;
    list.appendChild(li);
  });
}

// ---------- DEMO MATERIALS ----------
function ensureDemoMaterials(){
  let mats=JSON.parse(localStorage.getItem("materials"));
  if(!mats){
    mats=[
      {material:"Plastic",qty:20,location:"Mumbai",price:200},
      {material:"Metal",qty:10,location:"Delhi",price:300}
    ];
    localStorage.setItem("materials",JSON.stringify(mats));
  }
}

// ---------- LOAD MATERIALS ----------
function loadMaterials(){
  ensureDemoMaterials();
  let table=document.getElementById("materialTable");
  let data=JSON.parse(localStorage.getItem("materials"))||[];
  data.forEach(m=>{
    let row=table.insertRow(-1);
    row.innerHTML=`
      <td>${m.material}</td>
      <td>${m.qty}</td>
      <td>${m.location}</td>
      <td>₹${m.price}</td>
      <td><button onclick="buy('${m.material}',${m.price})">Buy</button></td>
    `;
  });
}

// ---------- SEARCH ----------
function searchTable(){
  let input=document.getElementById("buyerSearch").value.toLowerCase();
  let rows=document.getElementById("materialTable").rows;
  for(let i=1;i<rows.length;i++){
    let txt=rows[i].cells[0].innerText.toLowerCase();
    rows[i].style.display=txt.includes(input)?"":"none";
  }
}

// ---------- BUY ----------
function buy(mat,price){
  let orders=JSON.parse(localStorage.getItem("orders"))||[];
  orders.push({material:mat,price,status:"Requested"});
  localStorage.setItem("orders",JSON.stringify(orders));
  showToast("Order Placed");
  loadOrders();
}

// ---------- PROFILE ----------
function openProfile(){
  let p=JSON.parse(localStorage.getItem("profile"))||{};
  document.getElementById("pName").innerText="Name: "+(p.name||"Buyer");
  document.getElementById("pEmail").innerText="Email: "+(p.email||"-");
  document.getElementById("profileModal").style.display="flex";
  loadOrders();
}

function closeProfile(){
  document.getElementById("profileModal").style.display="none";
}

// ---------- ORDERS ----------
function loadOrders(){
  let list=document.getElementById("orders");
  list.innerHTML="";
  let data=JSON.parse(localStorage.getItem("orders"))||[];
  data.forEach(o=>{
    let li=document.createElement("li");
    li.innerText=`${o.material} – ₹${o.price} – ${o.status}`;
    list.appendChild(li);
  });
}

// ---------- INIT ----------
loadBuyerNotifications();
loadMaterials();
</script>

</body>
</html>
